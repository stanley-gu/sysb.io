"use strict";angular.module("sysbIoApp",["ngSanitize","ui.bootstrap","ui.ace","stanleygu.cytoscapeweb","stanley-gu.angular-rickshaw","blueimp.fileupload","ngCytoscape.js","infinite-scroll","highcharts-ng","ngRoute","ui.jq","ui.keypress","uiSlider"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/gallery",{templateUrl:"views/gallery.html",controller:"GalleryCtrl"}).when("/load",{templateUrl:"views/loadModal.html",controller:"LoadCtrl"}).when("/version",{templateUrl:"views/version.html",controller:"VersionCtrl"}).when("/version/:githubUserName/:githubRepository/:githubModelName*",{templateUrl:"views/version.html",controller:"VersionCtrl"}).when("/simulate",{templateUrl:"views/simulate.html",controller:"SimulateCtrl"}).when("/simulate/:githubUserName/:githubRepository/:githubModelName*",{templateUrl:"views/simulate.html",controller:"SimulateCtrl"}).when("/modelLayout",{templateUrl:"views/modelLayout.html",controller:"ModelLayoutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sysbIoApp").controller("MainCtrl",["$scope","$window","GithubLogin","App","Rpc","$modal",function(a,b,c,d,e,f){a.App=d,a.loginMessage=function(){return d.accessToken?"Logged in":"Log in"},a.loginToGithub=function(){d.accessToken||(b.OAuth.initialize("EFBBdvbz8MYOYgVTBxOG2sg7JGM"),b.OAuth.popup("github",function(b,c){a.$apply(function(){d.setAccessToken(c.access_token)})}))},a.logOutOfGithub=function(){d.removeAccessToken()},a.windowPaneSize="50-50",a.model={},a.$watch("App.getSbml()",function(){a.model.sbml=d.getSbml()}),d.rpc("loadModel",{sbml:d.getSbml()}),a.startModalLoadModel=function(){f.open({templateUrl:"views/loadModal.html",controller:"LoadModalCtrl"})},a.startModalVersion=function(){f.open({templateUrl:"views/versionModal.html",controller:"VersionCtrl"})},a.exportSbml=function(){f.open({templateUrl:"views/exportModal.html",controller:"ExportModalCtrl"})};var g=function(a){d.rpc("addSpecies",{id:a.id,name:a.name,compartment:a.compartment,initialAmount:a.initialAmount})},h=function(a){e.socket.emit("run",{method:"addCompartment",params:{id:a.id,size:a.size,constant:a.constant}})};a.newModel=function(){var a=f.open({templateUrl:"views/newModal.html"});a.result.then(function(a){e.socket.emit("run",{method:"createModel",params:{level:a.level,version:a.version,id:a.id,name:a.name}})})},a.saveModel=function(){d.saveSbml(a.modelSbml,function(){})},a.addSpeciesDefault=function(){var b="node"+a.model.species.length;0===a.model.compartments.length?(h({id:"compartment0",size:1,constant:!0}),d.rpc("addSpecies",{id:b,name:b,compartment:"compartment0",initialAmount:0})):d.rpc("addSpecies",{id:b,name:b,compartment:a.model.compartments[0].id,initialAmount:0})},a.addReactionDefault=function(){var b="reaction"+a.model.reactions.length;d.rpc("addReaction",{id:b,name:b})},a.addSpecies=function(){g({id:a.newSpeciesId,name:a.newSpeciesName,compartment:a.newSpeciesCompartment,initialAmount:a.newSpeciesInitialAmount})},a.getModel=function(){e.socket.emit("run",{method:"getModel",params:{}}),e.socket.emit("run",{method:"getCompartments",params:{}}),e.socket.emit("run",{method:"getSpecies",params:{}}),e.socket.emit("run",{method:"getReactions",params:{}}),e.socket.emit("run",{method:"getModelName",params:{}}),e.socket.emit("run",{method:"getModelId",params:{}})},a.getModel(),a.newReactants=[],a.newProducts=[],a.addReaction=function(){var b=[],c=[];a.newReactants.forEach(function(c,d){c&&b.push(a.model.species[d].id)}),a.newProducts.forEach(function(b,d){b&&c.push(a.model.species[d].id)}),e.socket.emit("run",{method:"addReaction",params:{id:a.newReactionId,name:a.newReactionName,reactants:b,products:c}}),a.newReactants=[],a.newProducts=[]},e.socket.on("output",function(b){if(b.id===e.socket.socket.sessionid){if(!b.error){if("getModel"===b.method){var c=b.response;c=b.response,d.saveSbml(c,function(b){b||(a.model.sbml=c,a.$apply())})}else"createModel"===b.method?a.getModel():"addSpecies"===b.method?a.getModel():"updateSpecies"===b.method?a.getModel():"addCompartment"===b.method?a.getModel():"addReaction"===b.method?a.getModel():"updateReaction"===b.method?a.getModel():"getCompartments"===b.method?a.model.compartments=b.response:"getSpecies"===b.method?a.model.species=b.response:"getReactions"===b.method?a.model.reactions=b.response:"getModelName"===b.method?a.model.name=b.response:"getModelId"===b.method&&(a.model.id=b.response);a.$apply()}b.error&&console.log("error: ",b.error)}}),a.speciesNodeStyle={shape:"roundrectangle",width:"60",height:"60",content:"data(id)","font-size":18,"text-valign":"center","text-outline-width":4,"text-outline-color":"black","border-color":"black","border-width":5,"background-color":"white",color:"white"},a.reactionNodeStyle={shape:"triangle",width:"60",height:"60",content:"data(id)","font-size":18,"text-valign":"center","text-outline-width":4,"text-outline-color":"black","border-color":"black","border-width":5,"background-color":"white",color:"white"},a.edgeStyle={width:5,"target-arrow-shape":"data(targetArrowShape)","line-color":"black","line-style":"data(lineStyle)","source-arrow-color":"black","target-arrow-color":"black"},a.$watch("speciesNodeStyle",function(){a.updateStyles()},!0),a.$watch("reactionNodeStyle",function(){a.updateStyles()},!0),a.$watch("edgeStyle",function(){a.updateStyles()},!0),a.updateSelectedNodes=function(){if(a.selected=a.cy.elements(":selected"),1===a.selected.length){var b=a.selected[0];if(b.hasClass("species")){var c=f.open({templateUrl:"views/speciesModal.html",controller:"SpeciesModalCtrl",resolve:{id:function(){return b.id()},model:function(){return a.model}}});c.result.then(function(a){d.rpc("updateSpecies",{id:b.id(),changes:a})})}else if(b.hasClass("reaction")){var c=f.open({templateUrl:"views/reactionModal.html",controller:"ReactionModalCtrl",resolve:{id:function(){return b.id()},model:function(){return a.model}}});c.result.then(function(a){d.rpc("updateReaction",{id:b.id(),changes:a})})}}},a.updateNodeStyle=function(a,b,c){try{a.css(b,c)}catch(d){console.log("error",d)}},a.cytConfig={},a.updateStyles=function(){a.cytConfig.style=[{selector:"node.species",css:a.speciesNodeStyle},{selector:"node.reaction",css:a.reactionNodeStyle},{selector:"edge",css:a.edgeStyle},{selector:":selected",css:{"border-color":"red","line-color":"red"}}]},a.layoutName="grid",a.$watch("layoutName",function(){a.cytConfig.layout={name:a.layoutName,fit:!0}}),a.cyZoom=!0,a.$watch("cyZoom",function(){a.cy&&a.cy.zoomingEnabled(a.cyZoom)})}]),angular.module("sysbIoApp").controller("LoadCtrl",["$scope","$http","GithubLogin","SbmlModel","Github",function(a,b,c,d,e){a.accessToken=c.getAccessToken(),a.github={},a.$watch("githubUserName",function(){console.log("Detected a change in User Name!"),e.getUserRepos(a.githubUserName,function(b){a.github.repos=b})}),a.$watch("githubRepository",function(){console.log("Detected a change in GitHub Repository Name!"),e.getRepoFiles(a.githubUserName,a.githubRepository,function(b){a.github.files=b})}),a.loadFromGithub=function(){e.getVersionHistory(a.githubUserName,a.githubRepository,a.githubModelName,function(b){a.models=b,d.setRepo(b)})},a.addVersion=function(){a.models.push({name:a.commitMessage,text:a.editorText,checked:!1})},a.loadFromText=function(){a.models=[],a.models.push({name:"SBML model",text:a.sbmlTextToLoad,checked:!1}),d.setRepo(a.models)},a.loadFromFile=function(){}}]),angular.module("sysbIoApp").controller("LoadModalCtrl",["$scope","App","$window","$modal","$modalInstance","$http","GithubLogin","SbmlModel",function(a,b,c,d,e){a.accessToken=b.accessToken;var f=b.github;a.github={},a.$watch("github.userName",function(){console.log("Detected a change in User Name!");var b=f.getUser(a.github.userName);b.repos(function(b,c){a.github.repos=c})}),a.$watch("github.repo",function(){console.log("Detected a change in GitHub Repository Name!");var b=f.getRepo(a.github.userName,a.github.repo);b.getTree("master?recursive=true",function(b,c){a.github.files=c})}),a.loadFromGithub=function(){a.loadingScreen={},a.loadingScreen.title="Loading Model...",a.loadingScreen.body="Hang on!",a.loadingScreen.status="active",d.open({templateUrl:"views/loadingScreenModal.html",scope:a});var c=f.getRepo(a.github.userName,a.github.repo);c.read("master",a.github.file,function(c,d){c?(a.loadingScreen.status="danger",a.loadingScreen.body="Sorry, could not load the model.",a.$apply()):b.saveSbml(d,function(b){b?(a.loadingScreen.status="danger",a.loadingScreen.body="Sorry, SBML is invalid."):(a.loadingScreen.status="success",a.loadingScreen.body="Done!"),a.$apply()})})},a.addVersion=function(){a.models.push({name:a.commitMessage,text:a.editorText,checked:!1})},a.loadFromText=function(c){a.loadingScreen={},a.loadingScreen.title="Loading Model...",a.loadingScreen.body="Hang on!",a.loadingScreen.status="active",d.open({templateUrl:"views/loadingScreenModal.html",scope:a}),b.saveSbml(c,function(b){b?(a.loadingScreen.status="danger",a.loadingScreen.body="Sorry, SBML is invalid."):(a.loadingScreen.status="success",a.loadingScreen.body="Done!"),a.$apply()})},a.loadFromFile=function(){},a.dropzoneConfig={url:"/",drop:function(b){console.log("dropped!"),console.log(b.dataTransfer.items[0]);var c=b.dataTransfer.items[0].getAsFile(),d=this,e=new FileReader;e.onload=function(){d.emit("success",c,"done",b),d.emit("complete",c,"done",b),a.loadFromText(e.result)},e.readAsText(c)},autoProcessQueue:!1,error:function(a,b,c){console.log("Error! ",c)}},a.cancel=function(){e.close()},a.ok=function(){e.close()}}]),angular.module("sysbIoApp").controller("ExportModalCtrl",["$scope","App",function(a,b){a.sbml=b.getSbml()}]),angular.module("sysbIoApp").controller("SpeciesModalCtrl",["$scope","$modalInstance","App","id","model",function(a,b,c,d,e){a.id=d,a.model=e,a.species={};var f={};a.model.species.forEach(function(a){f[a.id]=a}),a.name=f[d].name,a.initialAmount=f[d].initialAmount}]),angular.module("sysbIoApp").controller("ReactionModalCtrl",["$scope","$modalInstance","App","id","model",function(a,b,c,d,e){a.id=d,a.model=e;var f={};a.model.reactions.forEach(function(a){f[a.id]=a});var g=f[d];a.reaction={},a.reaction.species=[],a.model.species.forEach(function(b,c){var d=b.id;a.reaction.species.push({id:d}),g.reactants.indexOf(d)>-1?(a.reaction.species[c].reactant=1,a.reaction.species[c].reactant=!0):(a.reaction.species[c].reactant=0,a.reaction.species[c].reactant=!1),g.products.indexOf(d)>-1?(a.reaction.species[c].product=1,a.reaction.species[c].product=!0):(a.reaction.species[c].product=0,a.reaction.species[c].product=!1)}),a.name=g.name,a.kineticLaw=g.kineticLaw,a.save=function(){b.close(a.reaction)}}]),angular.module("sysbIoApp").controller("VersionCtrl",["$scope","SbmlModel","$http","SbmlDiff","$window","Github","$routeParams",function(a,b,c,d,e,f,g){var h=function(){a.models=b.getRepo(),a.bivesUrl="https://node-bives-c9-stanley-gu.c9.io",a.previewGraphml=b.getCurrentGraphml();var c=new XMLSerializer;a.previewSbml=c.serializeToString(b.getCurrentModel().sbml),a.loadVersion=function(d){b.setCurrentIndex(d),a.previewSbml=c.serializeToString(b.getCurrentModel().sbml)},a.compareVersions=function(){var b=[],c=0;return a.models.forEach(function(a,d){a.checked&&(c+=1,b.push(d))}),c>2?(e.alert("Please check only 2 versions to compare."),void 0):(2===c&&d.getDiff(a.models[b[0]].text,a.models[b[1]].text,"compareVersions",function(b){a.modelDiff=b.diff,a.graphml=b.graphml,a.$apply()}),void 0)}};g.githubUserName?f.getVersionHistory(g.githubUserName,g.githubRepository,g.githubModelName,function(c){b.setRepo(c),a.models=b.getRepo(),h()}):h()}]),angular.module("sysbIoApp").controller("SimulateCtrl",["$scope","$window","App","Rpc","Simulator","Github","$routeParams",function(a,b,c,d,e,f,g){var h=function(){a.App=c,a.simSbml=c.getSbml(),a.simStartTime=0,a.simEndTime=100,a.simNumSteps=100,a.params=[],a.chartConfig={options:{chart:{type:"line",zoomType:"x"},plotOptions:{series:{marker:{enabled:!1}}},credits:{enabled:!1}},series:[{data:[]}],title:{text:"Simulation Results"},loading:!1,xAxis:{currentMin:0,currentMax:20,title:{text:"Time (s)"}},useHighStocks:!1,navigator:{adaptToUpdatedData:!1}};var e=function(){d.socket.emit("run",{method:"simulate",params:{timeStart:a.simStartTime,timeEnd:a.simEndTime,numPoints:a.simNumSteps}})},f=function(){d.socket.emit("run",{method:"getParameters",params:{}})},g=function(a,b){d.socket.emit("run",{method:"setParameterValueById",params:{id:a,value:b}})},h=function(){d.socket.emit("run",{method:"getModel",params:{}})};a.$watch("App.getSbml()",function(){f(),e()}),a.$watch("simStartTime + simEndTime + simNumSteps",function(){a.chartConfig.xAxis.currentMin=a.simStartTime,a.chartConfig.xAxis.currentMax=a.simEndTime,e()}),a.paramUpdate=function(b){console.log("parameter updated!"),g(a.params[b].id,a.params[b].value),e()},a.saveModel=function(){h()},d.socket.on("output",function(c){if(c.id===d.socket.socket.sessionid&&!c.error)if("simulate"===c.method){var e,f,g,h,i,j;i=new b.Rickshaw.Color.Palette({scheme:"classic9"});var k=c.response;for(h=k[0].length-1,j=[],e=0;h>e;e+=1){for(g={},g.name=a.species[e].id,g.data=[],g.color=i.color(),f=1;f<k.length;f+=1)g.data.push({x:k[f][0],y:k[f][e+1]});j.push(g)}a.simData=j,a.chartConfig.series=j,a.$apply()}else c.method.indexOf("getParameters")>-1?(a.paramValues=c.response.values,a.paramIds=c.response.ids,a.params=[],a.paramIds.length?a.paramIds.forEach(function(b,c){a.params.push({id:b,value:a.paramValues[c]})}):a.params.push({id:a.paramIds,value:a.paramValues}),a.$apply()):c.method.indexOf("getParameterIds")>-1?(a.paramIds=c.response,a.$apply()):c.method.indexOf("getSpecies")>-1&&(a.species=c.response,a.$apply())})};g.githubUserName?f.getVersionHistory(g.githubUserName,g.githubRepository,g.githubModelName,function(a){SbmlModel.setRepo(a),h()}):h()}]),angular.module("sysbIoApp").service("GithubLogin",["$window",function(a){this.getAccessToken=function(){return a.localStorage.getItem("accessToken")?a.localStorage.getItem("accessToken"):null},this.setAccessToken=function(b){a.localStorage.setItem("accessToken",b)},this.removeAccessToken=function(){a.localStorage.removeItem("accessToken")}}]),angular.module("sysbIoApp").service("SbmlModel",["$window","Sbml",function(a,b){var c=new XMLSerializer;this.getModelName=function(){this.repo=this.getRepo(),this.model=this.getCurrentModel(),this.text=this.repo[this.getCurrentIndex()].text},this.getModelSbml=function(){var a;if(a=this.getCurrentModel())return c.serializeToString(a.sbml);throw"SBML Model Not Loaded"},this.setRepo=function(b){b.forEach(function(a){a.model&&delete a.model}),a.localStorage.setItem("sbmlRepo",JSON.stringify(b))},this.getRepo=function(){if(this.repo)return this.repo;if(this.repo=JSON.parse(a.localStorage.getItem("sbmlRepo")))return this.repo.forEach(function(a){a.model=b.loadSbml(a.text)}),this.repo;throw"No repo in localStorage"},this.updateModel=function(a){if(this.repo){var c=this.getCurrentIndex();this.repo[c].text=a,this.repo[c].model=b.loadSbml(a)}},this.saveModel=function(){this.setRepo(this.repo)},this.setCurrentIndex=function(b){a.localStorage.setItem("repoIndex",b)},this.getCurrentIndex=function(){return a.localStorage.getItem("repoIndex")},this.getCurrentModel=function(){if(this.repo&&this.getCurrentIndex()){var a=this.getCurrentIndex();return a=0,this.repo[a].model}this.repo=this.getRepo();var a=this.getCurrentIndex()||this.repo.length-1;if(a=0,this.repo)return this.model=this.repo[a].model,this.repo[a].model;throw"Repo not loaded"},this.setTwoDiffIndices=function(b){2===b.length&&a.localStorage.setItem("sbmlDiffIndices",JSON.stringify(b))},this.getTwoDiffIndices=function(){return JSON.parse(a.localStorage.getItem("sbmlDiffIndices"))},this.setCurrentGraphml=function(b){a.localStorage.setItem("sbmlGraphml",b)},this.getCurrentGraphml=function(){return a.localStorage.getItem("sbmlGraphml")}}]),angular.module("sysbIoApp").service("SbmlDiff",["$http","$window",function(a,b){this.bivesUrl="http://sysb.io:8002",this.getDiff=function(a,c,d,e){var f=b.io.connect(this.bivesUrl);f.emit("getDiff",{first:a,second:c,responseId:d}),f.on(d,function(a){e(a)})}}]),angular.module("sysbIoApp").service("Simulator",["$window",function(a){this.socket=a.io.connect("http://sysb.io:8003"),this.socket.on("connect",function(){console.log("connected to simulator")})}]),angular.module("sysbIoApp").service("Github",["$http","GithubLogin",function(a,b){function c(a){this.name="GithubError",this.message=a}var d=b.getAccessToken();this.getFile=function(b,c,e,f){a.defaults.headers.common.Accept=a.defaults.headers.common.Accept+", application/vnd.github.VERSION.raw";var g="https://api.github.com/repos/"+b+"/"+c+"/contents/"+e;d&&(g+="?access_token="+d),a.get(g).then(function(a){f(a.data)})},this.getUserRepos=function(b,c){var e="https://api.github.com/users/"+b+"/repos";d&&(e+="?access_token="+d+"&per_page=100"),a.get(e).then(function(a){var b=[];a.data.forEach(function(a){b.push(a.name)}),c(b)})},this.getRepoFiles=function(b,c,e){var f="https://api.github.com/repos/"+b+"/"+c+"/branches/master";d&&(f+="?access_token="+d),a.get(f).then(function(f){var g="https://api.github.com/repos/"+b+"/"+c+"/git/trees/"+f.data.commit.sha+"?recursive=1";d&&(g+="&access_token="+d),a.get(g).then(function(a){var b=[];a.data.tree.forEach(function(a){b.push(a.path)}),e(b)})})},this.getVersionHistory=function(b,c,e,f){a.defaults.headers.common.Accept=a.defaults.headers.common.Accept+", application/vnd.github.VERSION.raw";var g="https://api.github.com/repos/"+b+"/"+c+"/commits?path="+e;d&&(g+="&access_token="+d),a.get(g).then(function(g){g.data.forEach(function(a){console.log(a.commit.message)});var h=g.data,i=[],j=h.length,k=0;h.forEach(function(g,h,l){var m="https://api.github.com/repos/"+b+"/"+c+"/contents/"+e;d&&(m+="?access_token="+d),a.get(m,{params:{ref:g.sha}}).then(function(a){console.log(h),console.log(g.commit.message),k+=1,i[l.length-1-h]={name:g.commit.message,text:a.data,checked:!1},k===j&&f(i)})})})},this.createRepository=function(b,e,f){var g="https://api.github.com/user/repos";if(!d)throw new c("Need an access token to create a repo.");g+="?access_token="+d,a.post(g,{name:e,description:f}).then(function(a){console.log(a)})},this.createFile=function(b,e,f){var g="https://api.github.com/repos/"+b+"/"+e+"/contents/"+f;if(!d)throw new c("Need an access token to create a file.");g+="?access_token="+d,a.put(g,{message:"first commit",content:btoa("hello world")}).then(function(a){console.log(a)})}}]),angular.module("sysbIoApp").service("Rpc",["$window",function(a){this.socket=a.io.connect("http://simulate.sysb.io:80"),this.socket.on("connect",function(){console.log("connected to RPC server")})}]),angular.module("sysbIoApp").service("App",["SbmlModel","Rpc","GithubLogin","$window",function(a,b,c,d){this.github={},this.loginToGithub=function(){this.github=new d.Github({token:this.accessToken}),this.github.getUser(void 0,function(a,b){a||(this.github.user=b)})},this.accessToken=c.getAccessToken(),this.accessToken&&this.loginToGithub(),this.setAccessToken=function(a){this.accessToken=a,c.setAccessToken(a),this.loginToGithub()},this.removeAccessToken=function(){this.accessToken=null,c.removeAccessToken()},this.settings={view:{}},this.settings.view.windowPane={"90-10":{left:"col-md-11",right:"col-md-1"},"75-25":{left:"col-md-9",right:"col-md-3"},"50-50":{left:"col-md-6",right:"col-md-6"},"25-75":{left:"col-md-3",right:"col-md-9"},"10-90":{left:"col-md-1",right:"col-md-11"}},this.settings.view.toolbar={nodeStyles:{visible:!1},editModel:{visible:!1},simulate:{visible:!0}},this.getSbml=function(){return d.localStorage.getItem("sbml")},this.saveSbml=function(a,b){this.loadSbml(a,function(c,e){c||d.localStorage.setItem("sbml",a),b(c,e)})},this.loadSbml=function(a,c){this.rpc("loadModel",{sbml:a});var d=function(a){a.id===b.socket.socket.sessionid&&"loadModel"===a.method&&(c(a.error,a.response),b.socket.removeListener("output",d))};b.socket.on("output",d)},this.rpc=function(a,c){b.socket.emit("run",{method:a,params:c})}}]),angular.module("sysbIoApp").controller("GalleryCtrl",["$scope","$http","$window","Github","GithubLogin","SbmlDiff","SbmlModel","Sbml",function(a,b,c,d,e,f,g,h){a.bivesUrl="https://node-bives-c9-stanley-gu.c9.io",a.gallery=[],a.notes=[];var i=0;c.localStorage.getItem("galleryRepos")&&c.localStorage.getItem("galleryRepos").length>=12?a.galleryRepos=JSON.parse(c.localStorage.getItem("galleryRepos")):(a.galleryRepos=[],d.getFile("sysb-io","sysbio-gallery","list.txt",function(b){var e=b.split("\n");e.pop(),e.forEach(function(b){b=b.split(":");var e=b[0].split("/"),f=e[0],g=e[1],h=b[1];d.getFile(f,g,h,function(b){a.galleryRepos.push({user:f,repo:g,file:h,sbml:b}),0===i&&(a.loadMore(),i+=1),c.localStorage.setItem("galleryRepos",JSON.stringify(a.galleryRepos))})})})),a.loadingText="Loading more models.",a.loadMore=function(){if(i<a.galleryRepos.length){var b=a.galleryRepos[i],c=h.loadSbml(b.sbml);c.setGithubInfo(b.user,b.repo,b.file),a.gallery.push(c);var d="";try{var e=c.sbml.querySelector("body").cloneNode(!0);d=e.innerHTML}catch(f){}a.notes.push(d),i+=1}else a.loadingText=""},a.loadMore(),a.loadGalleryRepo=function(b){d.getVersionHistory(a.galleryRepos[b].user,a.galleryRepos[b].repo,a.galleryRepos[b].file,function(a){g.setRepo(a)})}}]),angular.module("sysbIoApp").directive("help",function(){return{transclude:!0,template:"<div ng-transclude></div>",restrict:"E",link:function(a,b){b.click(function(a){a.stopPropagation(),$("body").chardinJs("start")}),$(document).on("chardinJs:start",function(){$(".chardinjs-overlay").on("click",function(a){a.stopPropagation()})})}}}),angular.module("sysbIoApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isCurrentRoute=function(a){return b.path()===a}}]),angular.module("sysbIoApp").controller("ModelLayoutCtrl",["$scope","App","Rpc","$modal",function(a,b,c,d){a.App=b,a.windowPaneSize="50-50",a.modelSbml=b.getSbml(),b.rpc("loadModel",{sbml:b.getSbml()}),a.startModalLoadModel=function(){d.open({templateUrl:"views/loadModal.html",controller:"LoadModalCtrl"})},a.startModalVersion=function(){d.open({templateUrl:"views/versionModal.html",controller:"VersionCtrl"})},a.exportSbml=function(){d.open({templateUrl:"views/exportModal.html",controller:"ExportModalCtrl"})},a.saveModel=function(){b.saveSbml(a.modelSbml)},a.addSpecies=function(){b.rpc("addSpecies",{id:a.newSpeciesId,name:a.newSpeciesName,compartment:a.newSpeciesCompartment,initialAmount:a.newSpeciesInitialAmount})},a.getModel=function(){c.socket.emit("run",{method:"getModel",params:{}}),c.socket.emit("run",{method:"getCompartments",params:{}}),c.socket.emit("run",{method:"getSpecies",params:{}}),c.socket.emit("run",{method:"getReactions",params:{}}),c.socket.emit("run",{method:"getModelName",params:{}})},a.getModel(),a.newReactants=[],a.newProducts=[],a.addReaction=function(){var b=[],d=[];a.newReactants.forEach(function(c,d){c&&b.push(a.modelSpecies[d].id)}),a.newProducts.forEach(function(b,c){b&&d.push(a.modelSpecies[c].id)}),c.socket.emit("run",{method:"addReaction",params:{id:a.newReactionId,name:a.newReactionName,reactants:b,products:d}}),a.newReactants=[],a.newProducts=[]},c.socket.on("output",function(d){d.id===c.socket.socket.sessionid&&(d.error||("getModel"===d.method?(a.modelSbml=d.response,b.updateSbml(d.response)):"getCompartments"===d.method?a.modelCompartments=d.response:"getSpecies"===d.method?a.modelSpecies=d.response:"getReactions"===d.method?a.modelReactions=d.response:"getModelName"===d.method&&(a.modelName=d.response),a.$apply()),console.log("error",d.error),console.log("response",d.response),console.log("more",d.more))}),a.speciesNodeStyle={shape:"data(faveShape)",width:"mapData(weight, 40, 80, 20, 60)",content:"data(id)","font-size":10,"text-valign":"center","text-outline-width":2,"text-outline-color":"data(faveColor)","border-color":"black","border-width":3,"background-color":"white",color:"#fff"},a.reactionNodeStyle={shape:"data(faveShape)",width:"mapData(weight, 40, 80, 20, 60)",content:"data(id)","font-size":10,"text-valign":"center","text-outline-width":2,"text-outline-color":"data(faveColor)","border-color":"black","border-width":3,"background-color":"white",color:"#fff"},a.edgeStyle={width:3,"target-arrow-shape":"data(targetArrowShape)","line-color":"black","line-style":"data(lineStyle)","source-arrow-color":"black","target-arrow-color":"black"},a.$watch("speciesNodeStyle",function(){a.updateStyles()},!0),a.$watch("reactionNodeStyle",function(){a.updateStyles()},!0),a.$watch("edgeStyle",function(){a.updateStyles()},!0),a.updateSelectedNodes=function(){a.selected=a.cy.elements(":selected")},a.updateNodeStyle=function(a,b,c){try{a.css(b,c)}catch(d){console.log("error",d)}},a.updateStyles=function(){a.cytConfig=[{selector:"node.species",css:a.speciesNodeStyle},{selector:"node.reaction",css:a.reactionNodeStyle},{selector:"edge",css:a.edgeStyle},{selector:":selected",css:{"border-width":5,"border-color":"black"}}]}}]);